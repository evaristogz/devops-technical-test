apiVersion: v1
kind: Service
metadata:
  name: redis-headless
  namespace: ecommerce-app
  labels:
    app: ecommerce
    component: redis
    version: v1.0.0
  annotations:
    prometheus.io/scrape: "true"
    prometheus.io/port: "6379"
spec:
  # Headless service: No cluster IP, returns pod IPs directly
  # Used only for StatefulSet stable network identity
  clusterIP: None
  
  # Type: ClusterIP is the default for headless services
  type: ClusterIP
  
  # Publish not-ready addresses for StatefulSet pods
  # This ensures DNS records are created even if pods aren't ready
  publishNotReadyAddresses: true
  
  ports:
  - name: redis
    port: 6379
    targetPort: redis
    protocol: TCP
  
  # Selector: Routes to Redis pods
  selector:
    app: ecommerce
    component: redis

---
# Client Service: ClusterIP for app access to Redis single instance
apiVersion: v1
kind: Service
metadata:
  name: redis-service
  namespace: ecommerce-app
  labels:
    app: ecommerce
    component: redis
    version: v1.0.0
spec:
  type: ClusterIP
  
  ports:
  - name: redis
    port: 6379
    targetPort: redis
    protocol: TCP
  
  selector:
    app: ecommerce
    component: redis
