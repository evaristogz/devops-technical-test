# Default values for ecommerce-app Helm chart

global:
  nameOverride: ""
  fullnameOverride: "ecommerce"
  namespaceOverride: ""
  version: v1.0.0
  imageRegistry: acrecommerceegz1992.azurecr.io
  imagePullSecrets:
    - name: acr-secret

config:
  reactAppEnvironment: production
  reactAppApiUrl: https://api.ecommerce.example.com
  nodeEnv: production
  logLevel: info
  redisHost: redis-service.ecommerce-app.svc.cluster.local
  redisPort: "6379"

secrets:
  enabled: true
  name: ecommerce-secrets-local
  databaseUrl: postgresql://ecommerce_user:changeme@postgres-service:5432/ecommerce_db
  redisPassword: ""
  jwtSecret: change-this-in-production-use-key-vault
  apiKey: development-key

serviceAccounts:
  frontend:
    create: true
    name: ""
  backend:
    create: true
    name: ""

frontend:
  enabled: true
  replicaCount: 3
  image:
    repository: ecommerce-frontend
    tag: latest
    pullPolicy: IfNotPresent
  service:
    type: ClusterIP
    port: 3000
    targetPort: http
    sessionAffinity: ClientIP
    sessionAffinityTimeoutSeconds: 10800
  resources:
    requests:
      cpu: 100m
      memory: 128Mi
    limits:
      cpu: 200m
      memory: 256Mi
  probes:
    startup:
      httpGet:
        path: /
        port: http
        scheme: HTTP
      initialDelaySeconds: 10
      periodSeconds: 10
      timeoutSeconds: 5
      successThreshold: 1
      failureThreshold: 30
    liveness:
      httpGet:
        path: /health
        port: http
        scheme: HTTP
      initialDelaySeconds: 30
      periodSeconds: 30
      timeoutSeconds: 5
      successThreshold: 1
      failureThreshold: 3
    readiness:
      httpGet:
        path: /ready
        port: http
        scheme: HTTP
      initialDelaySeconds: 10
      periodSeconds: 10
      timeoutSeconds: 5
      successThreshold: 1
      failureThreshold: 3
  autoscaling:
    enabled: true
    minReplicas: 3
    maxReplicas: 10
    cpu: 60
    memory: 70
    behavior:
      scaleDown:
        stabilizationWindowSeconds: 300
        policies:
        - type: Percent
          value: 50
          periodSeconds: 60
        - type: Pods
          value: 2
          periodSeconds: 60
        selectPolicy: Min
      scaleUp:
        stabilizationWindowSeconds: 0
        policies:
        - type: Percent
          value: 100
          periodSeconds: 30
        - type: Pods
          value: 4
          periodSeconds: 30
        selectPolicy: Max

backend:
  enabled: true
  replicaCount: 2
  image:
    repository: ecommerce-backend
    tag: latest
    pullPolicy: IfNotPresent
  service:
    type: ClusterIP
    port: 8080
    targetPort: http
    sessionAffinity: ClientIP
    sessionAffinityTimeoutSeconds: 10800
  resources:
    requests:
      cpu: 200m
      memory: 256Mi
    limits:
      cpu: 500m
      memory: 512Mi
  probes:
    startup:
      httpGet:
        path: /health
        port: http
        scheme: HTTP
      initialDelaySeconds: 15
      periodSeconds: 10
      timeoutSeconds: 5
      successThreshold: 1
      failureThreshold: 20
    liveness:
      httpGet:
        path: /health
        port: http
        scheme: HTTP
      initialDelaySeconds: 30
      periodSeconds: 30
      timeoutSeconds: 5
      successThreshold: 1
      failureThreshold: 3
    readiness:
      httpGet:
        path: /ready
        port: http
        scheme: HTTP
      initialDelaySeconds: 10
      periodSeconds: 10
      timeoutSeconds: 5
      successThreshold: 1
      failureThreshold: 3
  autoscaling:
    enabled: true
    minReplicas: 2
    maxReplicas: 5
    cpu: 70
    memory: null
    behavior:
      scaleDown:
        stabilizationWindowSeconds: 300
        policies:
        - type: Percent
          value: 50
          periodSeconds: 60
        - type: Pods
          value: 1
          periodSeconds: 60
        selectPolicy: Min
      scaleUp:
        stabilizationWindowSeconds: 0
        policies:
        - type: Percent
          value: 100
          periodSeconds: 30
        - type: Pods
          value: 2
          periodSeconds: 30
        selectPolicy: Max

redis:
  enabled: true
  replicaCount: 1
  image:
    repository: redis
    tag: 7-alpine
    pullPolicy: IfNotPresent
  resources:
    requests:
      cpu: 100m
      memory: 128Mi
    limits:
      cpu: 200m
      memory: 256Mi
  persistence:
    storageClass: managed-csi
    size: 1Gi
  probes:
    liveness:
      tcpSocket:
        port: redis
      initialDelaySeconds: 30
      periodSeconds: 10
      timeoutSeconds: 5
      successThreshold: 1
      failureThreshold: 3
    readiness:
      exec:
        command:
        - redis-cli
        - ping
      initialDelaySeconds: 10
      periodSeconds: 10
      timeoutSeconds: 5
      successThreshold: 1
      failureThreshold: 3

ingress:
  enabled: false
  className: ""
  annotations: {}
  hosts: []
  tls: []
  # runAsNonRoot: true
  # runAsUser: 1001

# TODO: Configure network policies
networkPolicies:
  enabled: true

# TODO: Configure pod disruption budgets
podDisruptionBudget:
  enabled: true
  # maxUnavailable: 1

# TODO: Configure service accounts
serviceAccount:
  create: true
  # name: ""
  annotations: {}
    # azure.workload.identity/client-id: ""

# TODO: Configure node selectors and tolerations  
nodeSelector: {}
tolerations: []
affinity: {}